<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Dinosaur Juice</title>
		<meta property="og:type" content="website" />
		<meta property="og:description" content="A map of truck stops in North America." />
		<script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>
		<link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />
		<style type="text/css">
			html, body, #map {
				height: 100%;
				margin: 0px;
			}
		</style>
	</head>
	<body>
		<div id="map"></div>
		<script>
			const map = new maplibregl.Map({
				style: 'https://tiles.openfreemap.org/styles/liberty',
				center: [-96.5, 35.5],
				zoom: 5,
				container: 'map',
				hash: true
			});
			map.addControl(new maplibregl.NavigationControl());
			map.on('load', async function() {
				map.addSource('services-data', {
					type: 'geojson',
					data: 'data/services-hgv.geojson'
				});
				const loves = await map.loadImage('assets/logos/loves.png');
				map.addImage('loves', loves.data);
				const ta = await map.loadImage('assets/logos/ta.png');
				map.addImage('ta', ta.data);
				const flying = await map.loadImage('assets/logos/flying j.png');
				map.addImage('flying', flying.data);
				const pilot = await map.loadImage('assets/logos/pilot.png');
				map.addImage('pilot', pilot.data);
				const petro = await map.loadImage('assets/logos/petro.png');
				map.addImage('petro', petro.data);
				map.addLayer({
					id: 'services-layer',
					type: 'symbol',
					source: 'services-data',
					filter: ['==', 'highway', 'services'],
					layout: {
						'icon-image': ['match',
							['get', 'brand'],
							'Love\'s', 'loves',
							'TA', 'ta',
							'Flying J', 'flying',
							'Pilot', 'pilot',
							'Petro', 'petro',
							'car'
						]
					},
					maxzoom: 16
				});
				map.addLayer({
					id: 'services-polygon-layer',
					type: 'fill',
					source: 'services-data',
					filter: ['==', 'highway', 'services'],
					paint: {
						'fill-color': '#fc8',
						'fill-opacity': 0.4
					},
					minzoom: 16
				});
				map.addLayer({
					id: 'services-title-layer',
					type: 'symbol',
					source: 'services-data',
					filter: ['==', 'highway', 'services'],
					layout: {
						'text-field': '{name} {branch} {ref}',
						'text-size': 16,
						'text-font': ['Noto Sans Regular']
					},
					minzoom: 16
				});
				function click(e) {
					const services = e.features[0];

					const popup = document.createElement('div');

					const title = document.createElement('h3');
					title.appendChild(document.createTextNode(services.properties.name || '?'));
					title.style.display = 'inline';
					popup.appendChild(title);

					if (services.properties.branch) { popup.appendChild(document.createTextNode(' ' + services.properties.branch)); }
					if (services.properties.ref) { popup.appendChild(document.createTextNode(' | ' + services.properties.ref)); }

					const editLink = document.createElement('a');
					editLink.href = 'https://www.openstreetmap.org/' + services.properties['@id'];
					editLink.target = '_blank';
					editLink.style.textDecoration = 'none';
					editLink.appendChild(document.createTextNode('‚úèÔ∏è'));
					popup.appendChild(editLink);

					const address = document.createElement('address');
					address.appendChild(document.createTextNode(
						(services.properties["addr:housename"] ? services.properties["addr:housename"] + ', ' : '') +
						(services.properties["addr:housenumber"] ? services.properties["addr:housenumber"] + ' ' : '') +
						(services.properties["addr:street"] ? services.properties["addr:street"] + ', ' : (services.properties["addr:place"] ? services.properties["addr:place"] + ', ' : '')) +
						(services.properties["addr:city"] ? services.properties["addr:city"] + ', ' : '') +
						(services.properties["addr:postcode"] ? services.properties["addr:postcode"] + ', ' : '') +
						(services.properties["addr:state"] ? services.properties["addr:state"] + ', ' : '') +
						(services.properties["addr:country"] ? services.properties["addr:country"] : '')
					));
					popup.appendChild(address);

					if (services.properties.website) {
						const link = document.createElement('a');
						link.href = services.properties.website;
						link.rel = 'noreferrer noopener';
						link.target = '_blank';
						link.appendChild(document.createTextNode('Website'));
						popup.appendChild(link);
						popup.appendChild(document.createTextNode(' '));
					}
					if (services.properties.phone) {
						const link = document.createElement('a');
						link.href = services.properties.phone;
						link.appendChild(document.createTextNode('Call'));
						popup.appendChild(link);
						popup.appendChild(document.createTextNode(' '));
					}
					if (services.properties["contact:facebook"] || services.properties["brand:facebook"]) {
						const link = document.createElement('a');
						link.href = services.properties["contact:facebook"] || services.properties["brand:facebook"];
						link.rel = 'noreferrer noopener';
						link.target = '_blank';
						link.appendChild(document.createTextNode('Facebook'));
						popup.appendChild(link);
						popup.appendChild(document.createTextNode(' '));
					}

					popup.appendChild(document.createElement('br'));

					if (services.properties['hgv'] === 'yes' || services.properties['hgv'] === 'designated') { popup.appendChild(document.createTextNode('üöö')); }
					if (services.properties['motorcar'] === 'yes' || services.properties['motorcar'] === 'designated') { popup.appendChild(document.createTextNode('üöó')); }
					if (services.properties['bin'] == 'yes') { popup.appendChild(document.createTextNode('üóëÔ∏è')); }
					if (services.properties['compressed_air'] == 'yes') {popup.appendChild(document.createTextNode('üí®')); }
					if (services.properties['drinking_water'] == 'yes') { popup.appendChild(document.createTextNode('üíß')); }
					if (services.properties['internet_access'] == 'wlan') { popup.appendChild(document.createTextNode('üõú')); }

					new maplibregl.Popup()
						.setDOMContent(popup)
						.setLngLat(e.lngLat)
						.addTo(map);
				}
				map.on("click", "services-layer", click);
				map.on("click", "services-polygon-layer", click);
				map.on("click", "services-title-layer", click);
			});
		</script>
	</body>
</html>

